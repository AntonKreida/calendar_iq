(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var s=t.g.document;if(!e&&s&&(s.currentScript&&(e=s.currentScript.src),!e)){var n=s.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e+"../"})(),t.p,t.p;const e=t=>{if(void 0===t||!1===t||null===t)return document.createTextNode("");if("string"==typeof t||"number"==typeof t||!0===t)return document.createTextNode(t);if(Array.isArray(t)){const s=document.createDocumentFragment();return t.forEach((t=>{const n=e(t);s.appendChild(n)})),s}const s=document.createElement(t.tag);t.cls&&s.classList.add(...[].concat(t.cls).filter(Boolean)),t.attr&&Object.keys(t.attr).forEach((e=>{s.setAttribute(e,t.attr[e])}));const n=e(t.content);return s.appendChild(n),s},s=e,n=()=>{const t=new Date,e=t.getMonth();return{year:t.getFullYear(),month:e,monthDay:t.getDate(),day:t.getDay()}},o=new Date;class r{constructor(t,e){if(!(t instanceof HTMLElement))throw new Error("Это не HTML элемент!");this.element=t,this.suggestData=e,this.ListTitle=this.suggestData.map((t=>t.title)),this.onInput=this.onInput.bind(this),this.renderSuggest=this.renderSuggest.bind(this),this.clickSuggest=this.clickSuggest.bind(this),this.clickInput=this.clickInput.bind(this),this.element.addEventListener("click",this.clickInput),this.element.addEventListener("input",this.onInput)}onInput(){if(""===this.element.value)return this.removeSuggest(),this.clearSuggest(),void window.addEventListener("resize",(()=>{this.removeSuggest()}));this.filterData=this.ListTitle.filter((t=>t.toLowerCase().startsWith(this.element.value.toLowerCase()))),this.filterData.length?(this.removeSuggest(),this.renderSuggest(this.filterData),window.addEventListener("resize",(()=>{this.removeSuggest(),this.renderSuggest(this.filterData)}))):this.removeSuggest()}renderSuggest(t){if(this.clearSuggest(),null===this.filterData)return;this.suggest=s(r.template(t));const e=this.element.getBoundingClientRect(),{left:n,bottom:o,width:a}=e;this.suggest.style.top=`${o+window.scrollY+20}px`,this.suggest.style.left=`${n+window.scrollX}px`,this.suggest.style.width=`${a}px`,document.body.appendChild(this.suggest),this.suggest.addEventListener("click",this.clickSuggest)}clearSuggest(){this.suggest&&(this.suggest.innerHTML="")}removeSuggest(){this.suggest&&(this.suggest.remove(),this.suggest=void 0)}clickSuggest(t){const{target:e}=t,s=document.querySelector(".js-from-input"),n=document.querySelector(".js-suggest"),r=document.querySelector(".js-calendar"),a=document.querySelectorAll(".js-day");let l;s.value=e.textContent,this.suggestData.forEach((t=>{const s=t,{title:n,data:o}=s;n===e.textContent&&(l=o.split(".").map((t=>Number(t))))})),this.filterData=null,n.remove(),a.forEach((t=>{r.removeChild(t)})),o.setFullYear(l[2]),o.setMonth(l[1]-1),x()}clickInput(){this.element.value=""}}r.template=t=>({tag:"div",cls:["suggest","js-suggest"],content:t.map((t=>({tag:"div",cls:["suggest__item","js-item"],content:t})))});const a=r,l=t=>` \n<div class = 'day js-day'>\n  <h4 class = 'day__head js-day-head'>${t}</h4>\n  <div class = 'day__title js-title' data-title = 'eventTitle'></div>\n  <div class = 'day__subtitle js-subtitle' data-subtitle = 'subtitle'></div>\n  <div class = 'day__text js-text' data-text = 'text'></div>\n</div>`,i={type:{text:"text",button:"button",reset:"reset",submit:"submit"},img:"./images/icon_cross.svg",placeholder:{event:"Событие...",data:"День, месяц, год...",party:"Участники...",text:"Описание..."},name:{title:"eventTitle",data:"eventDate",party:"eventParty",text:"eventText"},buttonName:{ready:"Готово",delete:"Удалить",create:"Создать"}},c=t=>{if(t.classList.contains("active"))t.classList.remove("active","block"),t.removeChild(t.lastChild);else if(!t.classList.contains("active")){document.querySelectorAll(".js-day").forEach((t=>{t.classList.contains("active")&&(t.classList.remove("active","block"),t.removeChild(t.lastChild))})),t.classList.add("active","block"),t.appendChild((({type:t,img:e,placeholder:s,buttonName:n,name:o})=>{const r=`\n  <button class="btn-form-closest js-btn-form-closest" type="button">\n    <img class="icon-svg--cross" src="${e}" alt="none">\n  </button>  \n  <form class="day__form-event form js-form" action="/" method="GET" novalidate>\n    <input class="form__input day__form-input js-form-input js-input-title" type="${t.text}" placeholder="${s.event}" name="${o.title}" autocomplete="off" required>\n    <input class="form__input day__form-input js-form-input js-input-data" type="${t.text}" placeholder="${s.data}" name="${o.data}" readonly autocomplete="off" required>\n    <input class="form__input day__form-input js-form-input js-input-party" type="${t.text}" placeholder="${s.party}" name="${o.party}" autocomplete="off" required>\n    <textarea class="form__textarea js-form-input js-textarea" placeholder="${s.text}" name="${o.text}" autocomplete="off" required></textarea>\n    <div class="form__footer">\n      <div class="form-control">\n        <button class="btn-control btn-control-form js-btn-form" type="${t.submit}">${n.ready}</button>\n        <button class="btn-control btn-control-form js-button-reset" type="${t.button}">${n.delete}</button>\n      </div> \n      <div class="form-message hidden js-form-message">Заполните поля!</div> \n    </div>\n  </form>`,a=document.createElement("div");return a.classList.add("day__form","js-day-form"),a.innerHTML=r,a})(i)),document.querySelector(".js-form").addEventListener("submit",(t=>{t.preventDefault();const{target:e}=t,s=e.querySelectorAll(".js-form-input"),n=e.querySelector(".js-form-message"),o=e.closest(".js-day"),r=o.querySelector(".js-title"),a=o.querySelector(".js-subtitle"),l=o.querySelector(".js-text"),i=e.querySelector(".js-input-title"),c=e.querySelector(".js-input-party"),d=e.querySelector(".js-textarea");s.forEach((t=>{t.validity.valid?(t.classList.remove("invalid"),t.classList.add("valid")):(t.classList.add("invalid"),t.classList.remove("valid"))})),e.checkValidity()?(n.classList.add("hidden"),r.textContent=i.value,a.textContent=c.value,l.textContent=d.value,h.unlockEventForm(t),h.saveLocalElement(o),h.initSuggest()):n.classList.remove("hidden")})),(t=>{const e=t.querySelector(".js-input-data"),s=t.dataset.day;e.setAttribute("value",s);const n=t.querySelector(".js-input-title"),o=t.querySelector(".js-input-party"),r=t.querySelector(".js-textarea"),a=t.querySelector(".js-title"),l=t.querySelector(".js-subtitle"),i=t.querySelector(".js-text");n.setAttribute("value",a.textContent),o.setAttribute("value",l.textContent),r.textContent=i.textContent})(t),h.checkDay(t),t.querySelector(".js-btn-form-closest").addEventListener("click",h.unlockEventForm);const e=t.querySelector(".js-day-form");e.addEventListener("click",h.stopAscent);const s=e.getBoundingClientRect();s.right>window.innerWidth&&s.bottom>window.innerHeight?(e.classList.remove("day__form"),e.classList.add("day__form-active"),e.classList.add("top-active")):s.bottom>window.innerHeight?e.classList.add("top"):s.right>window.innerWidth&&(e.classList.remove("day__form"),e.classList.add("day__form-active")),t.querySelector(".js-button-reset").addEventListener("click",h.resetFormDay)}},{month:d,year:u}=n(),m=document.querySelector(".js-calendar"),p={onFocusHandler(){document.querySelector(".js-from-input").focus()},onReloadHandler(){const{location:t}=window;t.reload()},prevMonthHandler(){document.querySelectorAll(".js-day").forEach((t=>{m.removeChild(t)})),o.setMonth(o.getMonth()-1),x()},todayHandler(){document.querySelectorAll(".js-day").forEach((t=>{m.removeChild(t)})),o.setMonth(d),o.setFullYear(u),x()},nextMonthHandler(){document.querySelectorAll(".js-day").forEach((t=>{m.removeChild(t)})),o.setMonth(o.getMonth()+1),x()},showEventForm(t){const e=t.target.closest(".js-day");e.classList.contains("js-day")&&c(e)},unlockEventForm(t){const{target:e}=t,s=e.closest(".js-day");s.classList.remove("active"),s.classList.remove("block"),s.removeChild(s.lastChild),p.checkDay(s),p.resetLocalElement(s),p.initSuggest()},stopAscent(t){t.stopPropagation()},popupHandler(t){const{target:e}=t,s=e.closest(".js-header-buttons");s.appendChild((({type:t,buttonName:e,placeholder:s})=>{const n=`\n  <div class="popup__inner">\n      <button class="popup-button js-popup-button" type"${t.button}">\n        <svg class="icon-svg--cross" width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M3.54969 3.00004L5.88597 0.663692C6.03801 0.511722 6.03801 0.266008 5.88597 0.114038C5.734 -0.0379314 5.48829 -0.0379314 5.33632 0.114038L2.99996 2.45039L0.663685 0.114038C0.511644 -0.0379314 0.266001 -0.0379314 0.114031 0.114038C-0.0380103 0.266008 -0.0380103 0.511722 0.114031 0.663692L2.45031 3.00004L0.114031 5.33639C-0.0380103 5.48836 -0.0380103 5.73407 0.114031 5.88604C0.189767 5.96185 0.289348 5.99993 0.388858 5.99993C0.488368 5.99993 0.587878 5.96185 0.663685 5.88604L2.99996 3.54969L5.33632 5.88604C5.41212 5.96185 5.51163 5.99993 5.61114 5.99993C5.71065 5.99993 5.81016 5.96185 5.88597 5.88604C6.03801 5.73407 6.03801 5.48836 5.88597 5.33639L3.54969 3.00004Z" fill="black"></path>\n        </svg>\n      </button>  \n      <form class="form-popup js-form" action="/" method="GET" novalidate>\n          <input class="form__input popup__input js-from-input" type="${t.text}" placeholder="${s.event}" autocomplete="off" name="text" required>\n          <div class= "form-popup__popup-control popup-control">\n            <button class="btn-control btn-control--create js-btn-create" type="${t.submit}">${e.create}</button>\n            <div class="form-popup__popup-message popup-message js-message">\n              Формат: дд.мм.гггг, Заголовок, Участники, Описание\n            </div>\n          </div>\n      </form>\n  </div>`,o=document.createElement("div");return o.classList.add("popup","js-popup"),o.innerHTML=n,o})(i)),e.setAttribute("disabled","disabled");const n=s.lastChild,o=n.querySelector(".js-form");n.querySelector(".js-popup-button").addEventListener("click",p.unlockPopup),o.addEventListener("submit",p.submitPopup)},unlockPopup(t){const{target:e}=t,s=e.closest(".js-header-buttons");s.querySelector(".js-btn-push").removeAttribute("disabled"),s.removeChild(s.lastChild)},submitPopup(t){t.preventDefault();const{target:e}=t,s=e.querySelector(".js-message"),n=e.querySelector(".js-from-input"),{value:o}=n;if(!e.checkValidity()||-1===o.search(`^${"([^,]+),\\s*".repeat(3)}(.+)`))return n.classList.add("invalid"),s.classList.add("invalid"),void(s.textContent="Формат: дд.мм.гггг, Заголовок, Участники, Описание");let r=o.match(`^${"([^,]+),\\s*".repeat(3)}(.+)`);r=r.slice(1);const[a]=r[0].split(".");n.classList.remove("invalid"),s.classList.remove("invalid");const[l]=r,i=`<h4 class = 'day__head js-day-head'>${a}</h4>\n      <div class = 'day__title js-title' data-title = 'eventTitle'>${r[1]}</div>\n      <div class = 'day__subtitle js-subtitle' data-subtitle = 'subtitle'>${r[2]}</div>\n      <div class = 'day__text js-text' data-text = 'text'>${r[3]}</div>`,c={title:r[1],data:l,html:i};localStorage.setItem(l,JSON.stringify(c));const d=e.closest(".js-popup");document.querySelector(".js-btn-push").removeAttribute("disabled"),d.remove(),p.initSuggest(),document.querySelectorAll(".js-day").forEach((t=>{m.removeChild(t)})),x()},resetFormDay(t){const e=t.target.closest(".js-day"),s=document.querySelector(".js-input-title"),n=document.querySelector(".js-input-party"),o=document.querySelector(".js-textarea"),r=e.querySelector(".js-title"),a=e.querySelector(".js-subtitle"),l=e.querySelector(".js-text");s.removeAttribute("value"),n.removeAttribute("value"),s.value="",n.value="",o.value="",o.textContent="",r.textContent="",a.textContent="",l.textContent=""},checkDay(t){const e=t.querySelector(".js-title"),s=t.querySelector(".js-subtitle"),n=t.querySelector(".js-text");e.textContent.length>0||s.textContent.length>0||n.textContent.length>0?t.classList.add("valid"):t.classList.remove("valid")},saveLocalElement(t){const e=t.querySelector(".js-title"),s=t.querySelector(".js-subtitle"),n=t.querySelector(".js-text");if(e.textContent.length>0||s.textContent.length>0||n.textContent.length>0){const s=t.dataset.day,n=t.innerHTML,o={title:e.textContent,data:s,html:n};localStorage.setItem(s,JSON.stringify(o))}},resetLocalElement(t){const e=t.querySelector(".js-title"),s=t.querySelector(".js-subtitle"),n=t.querySelector(".js-text");if(0===e.textContent.length||0===s.textContent.length||0===n.textContent.length){const e=t.dataset.day;localStorage.removeItem(e)}},renderSaveDay(){document.querySelectorAll(".js-day").forEach((t=>{if(null!==localStorage.getItem(t.dataset.day)){const e=JSON.parse(localStorage.getItem(t.dataset.day));t.innerHTML=e.html}const e=t.querySelector(".js-title"),s=t.querySelector(".js-subtitle"),n=t.querySelector(".js-text");e.textContent.length>0||s.textContent.length>0||n.textContent.length>0?t.classList.add("valid"):t.classList.remove("valid")}))},initSuggest(){const t=document.querySelector(".js-from-input"),e=Object.values(localStorage),s=[];e.forEach((t=>{s.push(JSON.parse(t))})),new a(t,s)}},h=p,g=t=>"Декабрь"===t.textContent?o.getFullYear()+1:o.getFullYear(),y=t=>0===t?12:t<10?`0${t}`:13===t?"0"+(t=1):t,v=t=>t<10?`0${t}`:t,{year:f,month:j,monthDay:S}=n();let b=String(S);1===b.length&&(b=`0${b}`);let L=String(j);1===L.length&&"0"!==b?L=`0${L}`:b="01";const x=()=>{0===j?o.setDate(1):o.setDate(j);const t=new Date(o.getFullYear(),o.getMonth()+1,0).getDate(),e=new Date(o.getFullYear(),o.getMonth(),0).getDay(),s=new Date(o.getFullYear(),o.getMonth()+1,0).getDay();let n=7-s;0===s&&(n=0);const r=new Date(o.getFullYear(),o.getMonth(),0).getDate(),a=["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота ","Воскресенье"],i=document.querySelector(".js-data-month"),c=document.querySelector(".js-data-year"),d=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"][o.getMonth()];i.textContent=d,c.textContent=o.getFullYear();const u=document.querySelector(".js-calendar");for(let t=e;t>0;t-=1){u.innerHTML+=l([r-t+1]);const e=u.lastChild;e.dataset.day=`${v(r-t+1)}.${y(Number(o.getMonth()-1)+1)}.${m=i,"Январь"===m.textContent?o.getFullYear()-1:o.getFullYear()}`,e.classList.add("prev")}var m;for(let e=1;e<=t;e+=1)u.innerHTML+=l(e),u.lastChild.dataset.day=`${v(e)}.${y(Number(o.getMonth())+1)}.${o.getFullYear()}`;for(let t=1;t<=n;t+=1){u.innerHTML+=l(t);const e=u.lastChild;e.dataset.day=`${v(t)}.${y(Number(o.getMonth()+1)+1)}.${g(i)}`,e.classList.add("next")}h.renderSaveDay(),document.querySelectorAll(".js-day-head").forEach(((t,e)=>{e<7&&t.prepend(document.createTextNode(`${a[e]}, `))}));const p=`${b}.${Number(L)+1}.${f}`;document.querySelectorAll(".js-day").forEach((t=>{t.dataset.day===p&&t.classList.add("current")}))};window.addEventListener("DOMContentLoaded",(()=>{document.querySelector(".js-header-from-icon").addEventListener("click",h.onFocusHandler),document.querySelector(".js-btn-reload").addEventListener("click",h.onReloadHandler),document.querySelector(".js-btn-push").addEventListener("click",h.popupHandler),document.querySelector(".js-btn-control-prev").addEventListener("click",h.prevMonthHandler),document.querySelector(".js-btn-control-today").addEventListener("click",h.todayHandler),document.querySelector(".js-btn-control-next").addEventListener("click",h.nextMonthHandler),document.querySelector(".js-calendar").addEventListener("click",h.showEventForm),h.initSuggest(),x()}))})();